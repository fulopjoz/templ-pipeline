name: templ-pipeline-minimal
region: fra
features:
- buildpack-stack=ubuntu-22

services:
- name: templ-pipeline
  dockerfile_path: ./Dockerfile
  source_dir: /
  http_port: 8080
  instance_count: 1
  instance_size_slug: apps-s-2vcpu-4gb-fixed
  environment_slug: docker
  
  # Health check configuration - use Streamlit's built-in health endpoint
  health_check:
    http_path: /_stcore/health
    initial_delay_seconds: 120  # Allow more time for startup script logging
    period_seconds: 30
    timeout_seconds: 10
    success_threshold: 1
    failure_threshold: 3
  
  # Minimal environment variables - let startup script handle Streamlit config
  envs:
  - key: PYTHONPATH
    value: "/app"
  # Note: Removed all STREAMLIT_* environment variables to prevent conflicts
  # The startup script will set these based on the PORT variable

alerts:
- rule: DEPLOYMENT_FAILED
- rule: DOMAIN_FAILED
