Metadata-Version: 2.4
Name: templ-pipeline
Version: 0.1.0
Summary: TEMPL (Template-based Protein Ligand) pose prediction pipeline
Author-email: TEMPL Team <author@example.com>
License: MIT
Project-URL: Homepage, https://github.com/username/templ_pipeline
Project-URL: Bug Reports, https://github.com/username/templ_pipeline/issues
Project-URL: Source, https://github.com/username/templ_pipeline
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
Classifier: Topic :: Scientific/Engineering :: Chemistry
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.20.0
Requires-Dist: pandas>=1.3.0
Requires-Dist: scikit-learn>=1.0.0
Requires-Dist: rdkit>=2022.03.1
Requires-Dist: biopython>=1.79
Requires-Dist: tqdm>=4.62.0
Requires-Dist: biotite>=0.34.0
Requires-Dist: rich>=12.0.0
Requires-Dist: colorama>=0.4.4
Requires-Dist: spyrmsd>=0.8.0
Requires-Dist: pebble>=4.6.0
Requires-Dist: psutil>=5.8.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=3.0.0; extra == "dev"
Requires-Dist: black>=22.3.0; extra == "dev"
Requires-Dist: isort>=5.10.0; extra == "dev"
Requires-Dist: flake8>=4.0.0; extra == "dev"
Requires-Dist: mypy>=0.950; extra == "dev"
Provides-Extra: web
Requires-Dist: streamlit>=1.10.0; extra == "web"
Requires-Dist: py3Dmol>=1.8.0; extra == "web"
Requires-Dist: stmol>=0.0.9; extra == "web"
Provides-Extra: ai-cpu
Requires-Dist: transformers>=4.10.0; extra == "ai-cpu"
Requires-Dist: torch<2.0.0,>=1.10.0; extra == "ai-cpu"
Requires-Dist: sentence-transformers>=2.0.0; extra == "ai-cpu"
Provides-Extra: ai-gpu
Requires-Dist: transformers>=4.10.0; extra == "ai-gpu"
Requires-Dist: torch>=1.10.0; extra == "ai-gpu"
Requires-Dist: sentence-transformers>=2.0.0; extra == "ai-gpu"
Provides-Extra: examples
Requires-Dist: matplotlib>=3.5.0; extra == "examples"
Provides-Extra: scripts
Requires-Dist: umap-learn>=0.5.0; extra == "scripts"
Provides-Extra: full
Requires-Dist: streamlit>=1.10.0; extra == "full"
Requires-Dist: py3Dmol>=1.8.0; extra == "full"
Requires-Dist: stmol>=0.0.9; extra == "full"
Requires-Dist: transformers>=4.10.0; extra == "full"
Requires-Dist: torch<2.0.0,>=1.10.0; extra == "full"
Requires-Dist: sentence-transformers>=2.0.0; extra == "full"
Requires-Dist: matplotlib>=3.5.0; extra == "full"
Provides-Extra: server
Requires-Dist: streamlit>=1.10.0; extra == "server"
Requires-Dist: py3Dmol>=1.8.0; extra == "server"
Requires-Dist: stmol>=0.0.9; extra == "server"

# TEMPL Pipeline

Template-based protein–ligand pose prediction with a single command-line interface **and** a Streamlit web app.

---

## Why TEMPL?
TEMPL leverages **ligand similarity** and **template superposition** instead of exhaustive docking or deep neural networks. For familiar chemical space it provides fast, accurate poses with minimal compute.

* Alignment driven by maximal common substructure (MCS)
* Constrained conformer generation (ETKDG v3)
* Shape / pharmacophore scoring for pose selection
* Built-in benchmarks (Polaris, time-split PDBbind)
* CPU-only by default; GPU optional for protein embeddings

---

## 🚀 Smart One-Click Installation

After cloning this repository, run **one command**:

```bash
git clone https://github.com/fulopjoz/templ-pipeline
cd templ-pipeline
./setup_env_smart.sh    # That's it! 🎉
```

### 🎯 **What the Smart Installer Does:**

1. **🔍 Detects your hardware** - CPU cores, RAM, GPU availability
2. **🎛️ Recommends optimal configuration** - CPU-minimal, CPU-optimized, or GPU-enabled
3. **📦 Installs tailored dependencies** - No bloat! (PyTorch GPU libs = 5GB+ vs 500MB CPU-only)
4. **✅ Verifies everything works** - Tests CLI and imports
5. **🚀 Ready to use immediately** - `templ --help` works right away

### 🔧 **Installation Options:**

```bash
# Auto-detect hardware and install optimally (recommended)
./setup_env_smart.sh

# Force lightweight CPU-only installation (~500MB)
./setup_env_smart.sh --cpu-only

# Force GPU installation (if auto-detection fails)
./setup_env_smart.sh --gpu-force

# Minimal server installation (no web interface)
./setup_env_smart.sh --minimal

# Benchmark performance after installation
./setup_env_smart.sh --benchmark
```

**Returning later?** Simply activate the environment:
```bash
source .venv/bin/activate
```

### 💡 **Why Smart Installation?**

- **🏃‍♂️ Efficient**: CPU-minimal (~500MB) vs full AI stack (8GB+)
- **⚡ Hardware-aware**: Only installs GPU deps if GPU detected
- **🔧 Optimized**: Right-sized models (ESM-2 150M for CPU, larger for GPU)
- **🚫 No bloat**: Skip unnecessary ML libraries for basic docking

### Alternative Installation (Advanced Users)

<details>
<summary>Click to expand manual installation options</summary>

#### Using uv manually:
```bash
curl -Ls https://astral.sh/uv/install.sh | bash
uv venv .venv && source .venv/bin/activate
uv pip install -e "."                     # CPU-minimal
uv pip install -e ".[ai-cpu,web]"         # CPU-optimized + web
uv pip install -e ".[ai-gpu,web]"         # GPU-enabled
```

#### Using pip:
```bash
python -m venv .venv && source .venv/bin/activate
pip install -e "."
```

#### Using conda (if RDKit issues):
```bash
conda create -n templ python=3.10 rdkit -c conda-forge
conda activate templ
pip install -e "."
```
</details>

---

## Dataset Setup
TEMPL itself ships **no PDB structures or ligands**. Register and download datasets manually, then place them exactly as shown.

### PDBbind v2020
1. In this directory `templ_pipeline/data/PDBBind/` (case exact).
2. Unpack the following archives inside it so the layout becomes:
```
PDBBind/
├─ PDBbind_v2020_refined/refined-set/<PDB>/
└─ PDBbind_v2020_other_PL/v2020-other-PL/<PDB>/
```
TEMPL assumes this layout; if you prefer a different location pass `--data-root` to CLI commands.

### Polaris benchmark
Pre-processed SDFs plus metadata are already included under
`templ_pipeline/benchmark/data/polaris/`.

---

## Quick Start
```bash
# 1 line pose prediction
templ run \
  --protein-file examples/1a1c_protein.pdb \
  --ligand-smiles "CN(C)C(=O)Nc1cccc(c1)C2CCN(CC2)C" \
  --output poses.sdf
```

### Common CLI Commands
| Command | Purpose |
|---------|---------|
| `embed` | Generate or cache protein embeddings (ESM-2) |
| `find-templates` | K-NN template search in PDBbind |
| `generate-poses` | Constrained conformer generation & ranking |
| `run` | One-shot pipeline (`embed → search → pose`) |
| `benchmark` | Reproduce paper benchmarks (Polaris, time-split) |

Use `templ --help` or `templ <command> --help` for all options.

---

## Streamlit Web App
```python
python run_streamlit_app.py
```
* drag-and-drop PDB + SMILES or SDF
* download best poses as SDF

---

## Benchmarking Examples
```bash
# Polaris challenge (CPU-only, 8 workers)
templ benchmark polaris --n-workers 8 --n-conformers 200

# PDBbind time-split (ensure PDBBind/ downloaded first)
# To avoid nested parallelism, keep internal workers = 1 when using many benchmark workers.
templ benchmark time-split --n-workers 8 --pipeline-workers 1
```
---

## Development & Tests
```bash
./setup_env_uv.sh --dev  # Install with dev dependencies
pytest -q
```

---

